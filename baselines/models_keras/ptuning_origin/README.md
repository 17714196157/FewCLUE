# ptuning的相关预测代码

## 环境要求：
1. export TF_KERAS=1  (需要使用tf作为后端)
1. bert4keras (0.10.5)
1. Keras (2.3.1)
1. tensorflow-gpu (1.14.0)
1. h5py 2.10
1. chinese_roberta_wwm_ext_L-12_H-768_A-12

h5py：如果h5py是高版本，需要卸载h5py再安装h5py:
pip install h5py==2.10 -i https://pypi.tuna.tsinghua.edu.cn/simple/

## 内容
1. p-tuning:    
   基于bert4keras复现原论文模型结构，并在robert（12层）的基础上，对9个任务进行测试

## todo
1. 优化部分任务的模版及其他参数
1. 测试非公开测试集数据


## 测试方式
```python
python ptuning_iflytek.py 0 # 运行iflytek任务，并使用第0个数据集
```
模型的验证集/训练集/batch size/max seq len/训练轮次/模版格式等，对结果都有影响，可根据具体自行设置。

## 结果
| 数据集   | score     | eprstmt  | bustm  | ocnli   | csldcp   | tnews | wsc | ifytek| csl | chid  |
| :----:| :----:  | :----: |:----: |:----: |:----: |:----: |:----: |:----: |:----: |:----: |
|0|0.578132222| 0.85902	| 0.59086	| 0.38135	| 0.57063	| 0.55277	| 0.55328	| 0.57791	| 0.51797	| 0.5994	| 
|1|0.584647778| 0.88361	| 0.6456	| 0.34405	| 0.56166	| 0.54158	| 0.61373	| 0.57599	| 0.49471	| 0.6009	| 
|2|0.576458889| 0.87705	| 0.61456	| 0.34246	| 0.54877	| 0.53038	| 0.58402	| 0.57216	| 0.50035	| 0.61838	| 
|3|0.57269| 0.85738	| 0.62415	| 0.37302	| 0.54933	| 0.53412	| 0.5625	| 0.56577	| 0.50352	| 0.58442	| 
|4|0.576698889| 0.86721	| 0.57111	| 0.35	| 0.57063	| 0.55277	| 0.5625	| 0.59004	| 0.52713	| 0.5989	| 
|few_all|0.622237778| 0.89344	| 0.65011	| 0.44444	| 0.63509	| 0.55917	| 0.6752	| 0.62261	| 0.51868	| 0.6014	| 
|avg|0.577725556| 0.868854	| 0.609256	| 0.358176	| 0.560204	| 0.542324	| 0.575206	| 0.576374	| 0.508736	| 0.6004	| 
|std|-| 0.011357563	| 0.029001638	| 0.017823875	| 0.010822466	| 0.010353214	| 0.024317789	| 0.008936847	| 0.013396514	| 0.012063797	